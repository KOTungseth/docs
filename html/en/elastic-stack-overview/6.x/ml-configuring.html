<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring Machine Learning
        | Elastic Stack Overview [6.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [6.x]" /><link rel="up" href="xpack-ml.html" title="Machine Learning in the Elastic Stack" /><link rel="prev" href="ml-getting-started.html" title="Getting Started with Machine Learning" /><link rel="next" href="stopping-ml.html" title="Stopping Machine Learning" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/6.x" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.subject" content="Elastic Stack" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.identifier" content="6.x" />
    <!-- RTP tag -->
    <script type='text/javascript' async>
    (function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);})(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");

    rtp('send','view');
    rtp('get', 'campaign',true);
    </script> 
    <!-- End of RTP tag -->
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	   
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // ---------------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
        locales = {
            '/en/': '/',
            '/de/': '/de/',
            '/fr/': '/fr/',
            '/ja/':'/jp/',
            '/ko/':'/kr/',
            '/zh/':'/cn/'
        }
        localepages = ['/','/de/','/fr/','/jp/','/kr/','/cn/','/products','/de/products','/fr/products','/jp/products','/kr/products','/cn/products'],
        locationpath = window.location.pathname,
        localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
        currentlocale = JSON.parse(localeUrl);
    
      if(localepages.indexOf(locationpath) != -1){
        if($.cookie("c_lang")){
          if($.cookie("c_lang") != currentlocale.relative_url_prefix){
            var cookieurl = $.cookie("c_lang") + currentlocale.url.slice(1,currentlocale.url.length);
            window.location = cookieurl;
          }
        }
        else{
          var locale_lang = "/";
          if(locales[lang] != undefined){
            locale_lang = locales[lang];
          }
          $.cookie("c_lang",locale_lang ,{ expires: 365, path: '/'}); 
          window.location = localepages[localepages.indexOf(locationpath)];
        }
      }
      
      // --------------------- end of set language based on browser language -----------------
      </script>


	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- begin olark code -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
    f[z]=function(){
    (a.s=a.s||[]).push(arguments)};var a=f[z]._={
    },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
    0:+new Date};a.P=function(u){
    a.p[u]=new Date-a.p[0]};function s(){
    a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
    hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
    return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
    b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
    b.contentWindow[g].open()}catch(w){
    c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
    var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
    b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
    /* custom configuration goes here (www.olark.com/documentation) */
    olark.identify('1356-750-10-5709');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1356-750-10-5709/contact" title="Contact us">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <!-- end olark code -->

<!--     <script> 
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
      ga('create', 'UA-12395217-16', 'auto'); 
      ga('send', 'pageview'); 
    </script> -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->
    
    <!-- Header Section -->
    
<header class="header-wrapper">
  


  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <h1>
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/bltd5ac38b4549d53de/elastic-logo-mobile (1).svg" alt="elastic-logo-mobile">
              </a>
            </h1>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>
            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                <li><a href="/" data-value="/" id="locale-select">English</a></li>
                
                  
                    
                  
                <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                
                  
                    
                  
                <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                
                  
                    
                  
                <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                
                  
                    
                  
                <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                
                  
                    
                  
                <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <h1>
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt6050efb80ceabd47/elastic-logo (2).svg" alt="elastic-logo">
          </a>
        </h1>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a id="nav_products" class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_cloud" class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_services" class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_customers" class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_learn" class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
          <li class="hidden-xs lang global-language">
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              <li><a class="" href="/" data-value="/">English</a></li>
              
                
                  
                
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
                
                  
                
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
                
                  
                
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
                
                  
                
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
                
                  
                
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [6.x]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-ml.html">Machine Learning in the Elastic Stack</a></span> » <span class="breadcrumb-node">Configuring Machine Learning</span></div><div class="navheader"><span class="prev"><a href="ml-getting-started.html">
              « 
              Getting Started with Machine Learning</a>
           
        </span><span class="next">
           
          <a href="stopping-ml.html">Stopping Machine Learning
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring"></a>Configuring Machine Learning<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/configuring.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you want to use X-Pack machine learning features, there must be at least one machine learning node in
your cluster and all master-eligible nodes must have machine learning enabled. By default,
all nodes are machine learning nodes. For more information about these settings, see
<a class="xref" href="xpack-setup.html#xpack-settings" title="X-Pack Settings">X-Pack Settings</a>.</p><p>To use the X-Pack machine learning features to analyze your data, you must create a job and
send your data to that job.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
If your data is stored in Elasticsearch:
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
You can create a datafeed, which retrieves data from Elasticsearch for analysis.
</li><li class="listitem">
You can use Kibana to expedite the creation of jobs and datafeeds.
</li></ul></div></li><li class="listitem">
If your data is not stored in Elasticsearch, you can
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/ml-post-data.html" target="_top">POST data</a> from any source directly to an API.
</li></ul></div><p>The results of machine learning analysis are stored in Elasticsearch and you can use Kibana to help
you visualize and explore the results.</p><p>For a tutorial that walks you through these configuration steps,
see <a class="xref" href="ml-getting-started.html" title="Getting Started with Machine Learning"><em>Getting Started</em></a>.</p><p>Though it is quite simple to analyze your data and provide quick machine learning results,
gaining deep insights might require some additional planning and configuration.
The scenarios in this section describe some best practices for generating useful
machine learning results and insights from your data.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-url" title="Adding Custom URLs To Machine Learning Results">Adding Custom URLs To Machine Learning Results</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-aggregation" title="Aggregating Data For Faster Performance">Aggregating Data For Faster Performance</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-categories" title="Categorizing log messages">Categorizing log messages</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-pop" title="Performing Population Analysis">Performing Population Analysis</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform" title="Transforming Data With Script Fields">Transforming Data With Script Fields</a>
</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring-url"></a>Adding Custom URLs To Machine Learning Results<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/customurl.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When you create an advanced job or edit any job in Kibana, you can optionally
attach one or more custom URLs. You can also specify these custom settings when
you create or update jobs by using the machine learning APIs.</p><p>The custom URLs provide links from the anomalies table in the Anomaly Explorer
or Single Metric Viewer window in Kibana to custom dashboards or external
websites. For example, you can define a custom URL that provides a way for users
to drill down to the source data from the results set.</p><p>For each custom URL, you must supply the URL and a label, which is the link text
that appears in the anomalies table.</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-customurl.jpg" alt="Links in the Anomaly Explorer anoamilies table" /></div></div><h4><a id="_string_substitution_in_custom_urls"></a>String Substitution in Custom URLs<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/customurl.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>You can use dollar sign ($) delimited tokens in a custom URL. These tokens are
substituted for the values of the corresponding fields in the anomaly records.
For example, for a configured URL of
<code class="literal">http://my.datastore.com/dashboards?user=$user_name$</code>, the value of the
<code class="literal">user_name</code> field in the anomaly record is substituted into the <code class="literal">$user_name$</code>
token when you click the link in the anomalies table.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Not all fields in your source data exist in the anomaly results. If a
field is specified in the detector as the <code class="literal">field_name</code>, <code class="literal">by_field_name</code>,
<code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code>, for example, it can be used in a
custom URL. A field that is only used in the <code class="literal">categorization_field_name</code>
property, however, does not exist in the anomaly results.</p></div></div><p>The following keywords can also be used as tokens for string substitution in a
custom URL: <code class="literal">$earliest$</code>; <code class="literal">$latest$</code>; <code class="literal">$mlcategoryregex$</code>; <code class="literal">$mlcategoryterms$</code>.</p><p>The <code class="literal">$earliest$</code> and <code class="literal">$latest$</code> tokens pass the beginning and end of the time
span of the selected anomaly to the target page. The tokens are substituted with
date-time strings in ISO-8601 format. If you selected an interval of 1 hour for
the anomalies table, these tokens use one hour on either side of the anomaly
time as the earliest and latest times. The same is also true if the interval is
set to <code class="literal">Auto</code> and a one hour interval was chosen.</p><p>The <code class="literal">$mlcategoryregex$</code> and <code class="literal">$mlcategoryterms$</code> tokens pertain to jobs where you
are categorizing field values. For more information about this type of analysis,
see <a class="xref" href="ml-configuring.html#ml-configuring-categories" title="Categorizing log messages">Categorizing log messages</a>.</p><p>The <code class="literal">$mlcategoryregex$</code> token passes the regular expression value of the
category of the selected anomaly, as identified by the value of the <code class="literal">mlcategory</code>
field of the anomaly record.</p><p>The <code class="literal">$mlcategoryterms$</code> token likewise passes the terms value of the category of
the selected anomaly. Each categorization term is prefixed by a plus (+)
character, so that when the token is passed to a Kibana dashboard, the resulting
dashboard query seeks a match for all of the terms of the category.</p><p>For example, the following API updates a <code class="literal">log_categories</code> job to add a custom
URL that uses <code class="literal">$earliest$</code>, <code class="literal">$latest$</code>, and <code class="literal">$mlcategoryterms$</code> tokens:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/anomaly_detectors/log_categories/_update
{
  "custom_settings": {
        "custom_urls": [
          {
            "url_name": "test-link1",
            "url_value": "http://localhost:5601/app/kibana#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:'$earliest$',mode:quick,to:'$latest$'))&amp;_a=(columns:!(_source),index:AV3OWB68ue3Ht69t29aw,interval:auto,query:(query_string:(analyze_wildcard:!t,query:'$mlcategoryterms$')),sort:!(time,desc))"
          }
        ]
      }
}</pre></div><p>When you click this custom URL in the anomalies table in Kibana, it opens up the
Discover page and displays source data for the period when the anomaly occurred.
Since this job was categorizing log messages, some <code class="literal">$mlcategoryterms$</code> token
values that were passed to the target page for an example anomaly are as follows:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-categoryterms.jpg" alt="A query for category terms on the Discover page in Kibana" /></div></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The custom URL links in the anomaly tables use pop-ups. You must configure
your web browser so that it does not block pop-up windows or create an exception
for your Kibana URL.
</li><li class="listitem">
When creating a link to a Kibana dashboard, the URLs for dashboards can be very
long. Be careful of typos, end of line characters, and URL encoding. Also ensure
you use the appropriate index ID for the target Kibana index pattern.
</li><li class="listitem">
If you use an influencer name for string substitution, keep in mind that it
might not always be available in the analysis results and the URL is invalid in
those cases. There is not always a statistically significant influencer for each
anomaly.
</li><li class="listitem">
The dates substituted for <code class="literal">$earliest$</code> and <code class="literal">$latest$</code> tokens are in
ISO-8601 format and the target system must understand this format.
</li><li class="listitem">
If the job performs an analysis against nested JSON fields, the tokens for
string substitution can refer to these fields using dot notation. For example,
<code class="literal">$cpu.total$</code>.
</li><li class="listitem">
Elasticsearch source data mappings might make it difficult for the query string to work.
Test the custom URL before saving the job configuration to check that it works
as expected, particularly when using string substitution.
</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring-aggregation"></a>Aggregating Data For Faster Performance<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>By default, datafeeds fetch data from Elasticsearch using search and scroll requests.
It can be significantly more efficient, however, to aggregate data in Elasticsearch
and to configure your jobs to analyze aggregated data.</p><p>One of the benefits of aggregating data this way is that Elasticsearch automatically
distributes these calculations across your cluster. You can then feed this
aggregated data into X-Pack machine learning instead of raw results, which
reduces the volume of data that must be considered while detecting anomalies.</p><p>There are some limitations to using aggregations in datafeeds, however.
Your aggregation must include a buckets aggregation, which in turn must contain
a date histogram aggregation. This requirement ensures that the aggregated
data is a time series. If you use a terms aggregation and the cardinality of a
term is high, then the aggregation might not be effective and you might want
to just use the default search and scroll behavior.</p><p>When you create or update a job, you can include the names of aggregations, for
example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/farequote
{
  "analysis_config": {
    "bucket_span": "60m",
    "detectors": [{
      "function":"mean",
      "field_name":"responsetime",
      "by_field_name":"airline"
    }],
    "summary_count_field_name": "doc_count"
  },
  "data_description": {
    "time_field":"time"
  }
}</pre></div><p>In this example, the <code class="literal">airline</code>, <code class="literal">responsetime</code>, and <code class="literal">time</code> fields are
aggregations.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>When the <code class="literal">summary_count_field_name</code> property is set to a non-null value,
the job expects to receive aggregated input. The property must be set to the
name of the field that contains the count of raw data points that have been
aggregated. It applies to all detectors in the job.</p></div></div><p>The aggregations are defined in the datafeed as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/datafeeds/datafeed-farequote
{
  "job_id":"farequote",
  "indices": ["farequote"],
  "types": ["response"],
  "aggregations": {
    "buckets": {
      "date_histogram": {
        "field": "time",
        "interval": "360s",
        "time_zone": "UTC"
      },
      "aggregations": {
        "time": {
          "max": {"field": "time"}
        },
        "airline": {
          "terms": {
            "field": "airline",
            "size": 100
          },
          "aggregations": {
            "responsetime": {
              "avg": {
                "field": "responsetime"
              }
            }
          }
        }
      }
    }
  }
}</pre></div><p>In this example, the aggregations have names that match the fields that they
operate on. That is to say, the <code class="literal">max</code> aggregation is named <code class="literal">time</code> and its
field is also <code class="literal">time</code>. The same is true for the aggregations with the names
<code class="literal">airline</code> and <code class="literal">responsetime</code>. Since you must create the job before you can
create the datafeed, synchronizing your aggregation and field names can simplify
these configuration steps.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If you use a <code class="literal">max</code> aggregation on a time field, the aggregation name
in the datafeed must match the name of the time field, as in the previous example.
For all other aggregations, if the aggregation name doesn’t match the field name,
there are limitations in the drill-down functionality within the machine learning page in
Kibana.</p></div></div><p>When you define an aggregation in a datafeed, it must have the following form:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"aggregations" : {
  "buckets" : {
    "date_histogram" : {
      "time_zone": "UTC", ...
    },
    "aggregations": {
      "&lt;time_field&gt;": {
        "max": {
          "field":"&lt;time_field&gt;"
        }
      }
      [,"&lt;first_term&gt;": {
        "terms":{...
        }
        [,"aggregations" : {
          [&lt;sub_aggregation&gt;]+
        } ]
      }]
   }
 }
}</pre></div><p>You must specify <code class="literal">buckets</code> as the aggregation name and <code class="literal">date_histogram</code> as the
aggregation type. For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations-bucket-datehistogram-aggregation.html" target="_top">Date Histogram Aggregation</a>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">time_zone</code> parameter in the date histogram aggregation must be set to <code class="literal">UTC</code>,
which is the default value.</p></div></div><p>Each histogram bucket has a key, which is the bucket start time. This key cannot
be used for aggregations in datafeeds, however, because they need to know the
time of the latest record within a bucket. Otherwise, when you restart a datafeed,
it continues from the start time of the histogram bucket and possibly fetches
the same data twice. The max aggregation for the time field is therefore
necessary to provide the time of the latest record within a bucket.</p><p>You can optionally specify a terms aggregation, which creates buckets for
different values of a field.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If you use a terms aggregation, by default it returns buckets for
the top ten terms. Thus if the cardinality of the term is greater than 10, not
all terms are analyzed.</p></div></div><p>You can change this behavior by setting the <code class="literal">size</code> parameter. To
determine the cardinality of your data, you can run searches such as:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET .../_search {
  "aggs": {
    "service_cardinality": {
      "cardinality": {
        "field": "service"
        }
    }
  }
}</pre></div><p>By default, Elasticsearch limits the maximum number of terms returned to 10000. For high
cardinality fields, the query might not run. It might return errors related to
circuit breaking exceptions that indicate that the data is too large. In such
cases, do not use aggregations in your datafeed. For more
information, see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations-bucket-terms-aggregation.html" target="_top">Terms Aggregation</a>.</p><p>You can also optionally specify multiple sub-aggregations.
The sub-aggregations are aggregated for the buckets that were created by their
parent aggregation. For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations.html" target="_top">Aggregations</a>.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>If your detectors use metric or sum analytical functions, set the
<code class="literal">interval</code> of the date histogram aggregation to a tenth of the <code class="literal">bucket_span</code>
that was defined in the job. This suggestion creates finer, more granular time
buckets, which are ideal for this type of analysis. If your detectors use count
or rare functions, set <code class="literal">interval</code> to the same value as <code class="literal">bucket_span</code>. For more
information about analytical functions, see <a class="xref" href="ml-functions.html" title="Function Reference"><em>Function Reference</em></a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring-categories"></a>Categorizing log messages<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/categories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Application log events are often unstructured and contain variable data. For
example:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{"time":1454516381000,"message":"org.jdbi.v2.exceptions.UnableToExecuteStatementException: com.mysql.jdbc.exceptions.MySQLTimeoutException: Statement cancelled due to timeout or client request [statement:\"SELECT id, customer_id, name, force_disabled, enabled FROM customers\"]","type":"logs"}</pre></div><p>You can use machine learning to observe the static parts of the message, cluster similar
messages together, and classify them into message categories.</p><p>The machine learning model learns what volume and pattern is normal for each category over
time. You can then detect anomalies and surface rare events or unusual types of
messages by using count or rare functions. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/it_ops_new_logs
{
  "description" : "IT Ops Application Logs",
  "analysis_config" : {
    "categorization_field_name": "message", <a id="CO56-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "bucket_span":"30m",
    "detectors" :[{
      "function":"count",
      "by_field_name": "mlcategory", <a id="CO56-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "detector_description": "Unusual message counts"
    }],
    "categorization_filters":[ "\\[statement:.*\\]"]
  },
  "analysis_limits":{
    "categorization_examples_limit": 5
  },
  "data_description" : {
    "time_field":"time",
    "time_format": "epoch_ms"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/1.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO56-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">categorization_field_name</code> property indicates which field will be
categorized.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO56-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The resulting categories are used in a detector by setting <code class="literal">by_field_name</code>,
<code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code> to the keyword <code class="literal">mlcategory</code>. If you
do not specify this keyword in one of those properties, the API request fails.
</p></td></tr></table></div><p>The optional <code class="literal">categorization_examples_limit</code> property specifies the
maximum number of examples that are stored in memory and in the results data
store for each category. The default value is <code class="literal">4</code>. Note that this setting does
not affect the categorization; it just affects the list of visible examples. If
you increase this value, more examples are available, but you must have more
storage available. If you set this value to <code class="literal">0</code>, no examples are stored.</p><p>The optional <code class="literal">categorization_filters</code> property can contain an array of regular
expressions. If a categorization field value matches the regular expression, the
portion of the field that is matched is not taken into consideration when
defining categories. The categorization filters are applied in the order they
are listed in the job configuration, which allows you to disregard multiple
sections of the categorization field value. In this example, we have decided that
we do not want the detailed SQL to be considered in the message categorization.
This particular categorization filter removes the SQL statement from the categorization
algorithm.</p><p>If your data is stored in Elasticsearch, you can create an advanced job with these same
properties:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-category-advanced.jpg" alt="Advanced job configuration options related to categorization" /></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>To add the <code class="literal">categorization_examples_limit</code> property, you must use the
<span class="strong strong"><strong>Edit JSON</strong></span> tab and copy the <code class="literal">analysis_limits</code> object from the API example.</p></div></div><h4><a id="ml-configuring-analyzer"></a>Customizing the Categorization Analyzer<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/categories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Categorization uses English dictionary words to identify log message categories.
By default, it also uses English tokenization rules. For this reason, if you use
the default categorization analyzer, only English language log messages are
supported, as described in the <a class="xref" href="ml-limitations.html" title="Machine Learning Limitations"><em>Machine Learning Limitations</em></a>.</p><p>You can, however, change the tokenization rules by customizing the way the
categorization field values are interpreted. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/it_ops_new_logs2
{
  "description" : "IT Ops Application Logs",
  "analysis_config" : {
    "categorization_field_name": "message",
    "bucket_span":"30m",
    "detectors" :[{
      "function":"count",
      "by_field_name": "mlcategory",
      "detector_description": "Unusual message counts"
    }],
    "categorization_analyzer":{
      "char_filter": [
        { "type": "pattern_replace", "pattern": "\\[statement:.*\\]" } <a id="CO57-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      ],
      "tokenizer": "ml_classic", <a id="CO57-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "filter": [
        { "type" : "stop", "stopwords": [
          "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday",
          "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun",
          "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December",
          "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec",
          "GMT", "UTC"
        ] } <a id="CO57-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
      ]
    }
  },
  "analysis_limits":{
    "categorization_examples_limit": 5
  },
  "data_description" : {
    "time_field":"time",
    "time_format": "epoch_ms"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/2.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/analysis-pattern-replace-charfilter.html" target="_top"><code class="literal">pattern_replace</code> character filter</a>
here achieves exactly the same as the <code class="literal">categorization_filters</code> in the first
example.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">ml_classic</code> tokenizer works like the non-customizable tokenization
that was used for categorization in older versions of machine learning. If you
want the same categorization behavior as older versions, use this property value.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By default, English day or month words are filtered from log messages before
categorization. If your logs are in a different language and contain
dates, you might get better results by filtering the day or month words in your
language.
</p></td></tr></table></div><p>The optional <code class="literal">categorization_analyzer</code> property allows even greater customization
of how categorization interprets the categorization field value. It can refer to
a built-in Elasticsearch analyzer or a combination of zero or more character filters,
a tokenizer, and zero or more token filters.</p><p>The <code class="literal">ml_classic</code> tokenizer and the day and month stopword filter are more or less
equivalent to the following analyzer, which is defined using only built-in Elasticsearch
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/analysis-tokenizers.html" target="_top">tokenizers</a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/analysis-tokenfilters.html" target="_top">token filters</a>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/it_ops_new_logs3
{
  "description" : "IT Ops Application Logs",
  "analysis_config" : {
    "categorization_field_name": "message",
    "bucket_span":"30m",
    "detectors" :[{
      "function":"count",
      "by_field_name": "mlcategory",
      "detector_description": "Unusual message counts"
    }],
    "categorization_analyzer":{
      "tokenizer": {
        "type" : "simple_pattern_split",
        "pattern" : "[^-0-9A-Za-z_.]+" <a id="CO58-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      },
      "filter": [
        { "type" : "pattern_replace", "pattern": "^[0-9].*" }, <a id="CO58-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        { "type" : "pattern_replace", "pattern": "^[-0-9A-Fa-f.]+$" }, <a id="CO58-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        { "type" : "pattern_replace", "pattern": "^[^0-9A-Za-z]+" }, <a id="CO58-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        { "type" : "pattern_replace", "pattern": "[^0-9A-Za-z]+$" }, <a id="CO58-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
        { "type" : "stop", "stopwords": [
          "",
          "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday",
          "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun",
          "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December",
          "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec",
          "GMT", "UTC"
        ] }
      ]
    }
  },
  "analysis_limits":{
    "categorization_examples_limit": 5
  },
  "data_description" : {
    "time_field":"time",
    "time_format": "epoch_ms"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/3.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Tokens basically consist of hyphens, digits, letters, underscores and dots.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By default, categorization ignores tokens that begin with a digit.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
By default, categorization also ignores tokens that are hexadecimal numbers.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Underscores, hyphens, and dots are removed from the beginning of tokens.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Underscores, hyphens, and dots are also removed from the end of tokens.
</p></td></tr></table></div><p>The key difference between the default <code class="literal">categorization_analyzer</code> and this example
analyzer is that using the <code class="literal">ml_classic</code> tokenizer is several times faster. The
difference in behavior is that this custom analyzer does not include accented
letters in tokens whereas the <code class="literal">ml_classic</code> tokenizer does, although that could
be fixed by using more complex regular expressions.</p><p>For more information about the <code class="literal">categorization_analyzer</code> property, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/ml-job-resource.html#ml-categorizationanalyzer" target="_top">Categorization Analyzer</a>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>To add the <code class="literal">categorization_analyzer</code> property in Kibana, you must use the
<span class="strong strong"><strong>Edit JSON</strong></span> tab and copy the <code class="literal">categorization_analyzer</code> object from one of the
API examples above.</p></div></div><h4><a id="ml-viewing-categories"></a>Viewing Categorization Results<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/categories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>After you open the job and start the datafeed or supply data to the job, you can
view the categorization results in Kibana. For example:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-category-anomalies.jpg" alt="Categorization example in the Anomaly Explorer" /></div></div><p>For this type of job, the <span class="strong strong"><strong>Anomaly Explorer</strong></span> contains extra information for
each anomaly: the name of the category (for example, <code class="literal">mlcategory 11</code>) and
examples of the messages in that category. In this case, you can use these
details to investigate occurrences of unusually high message counts for specific
message categories.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring-pop"></a>Performing Population Analysis<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/populations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Entities or events in your data can be considered anomalous when:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Their behavior changes over time, relative to their own previous behavior, or
</li><li class="listitem">
Their behavior is different than other entities in a specified population.
</li></ul></div><p>The latter method of detecting outliers is known as <span class="emphasis"><em>population analysis</em></span>. The
machine learning analytics build a profile of what a "typical" user, machine, or other entity
does over a specified time period and then identify when one is behaving
abnormally compared to the population.</p><p>This type of analysis is most useful when the behavior of the population as a
whole is mostly homogeneous and you want to identify outliers. In general,
population analysis is not useful when members of the population inherently
have vastly different behavior. You can, however, segment your data into groups
that behave similarly and run these as separate jobs. For example, you can use a
query filter in the datafeed to segment your data or you can use the
<code class="literal">partition_field_name</code> to split the analysis for the different groups.</p><p>Population analysis scales well and has a lower resource footprint than
individual analysis of each series. For example, you can analyze populations
of hundreds of thousands or millions of entities.</p><p>To specify the population, use the <code class="literal">over_field_name</code> property. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/population
{
  "description" : "Population analysis",
  "analysis_config" : {
    "bucket_span":"10m",
    "influencers": [
      "username"
    ],
    "detectors": [
      {
        "function": "mean",
        "field_name": "bytesSent",
        "over_field_name": "username" <a id="CO59-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    ]
  },
  "data_description" : {
    "time_field":"@timestamp",
    "time_format": "epoch_ms"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/4.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO59-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This <code class="literal">over_field_name</code> property indicates that the metrics for each user (
  as identified by their <code class="literal">username</code> value) are analyzed relative to other users
  in each bucket.
</p></td></tr></table></div><p>If your data is stored in Elasticsearch, you can use the population job wizard in Kibana
to create a job with these same properties. For example, the population job
wizard provides the following job settings:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-population-job.jpg" alt="&quot;Job settings in the population job wizard" /></div></div><p>After you open the job and start the datafeed or supply data to the job, you can
view the results in Kibana. For example, you can view the results in the
<span class="strong strong"><strong>Anomaly Explorer</strong></span>:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-population-results.jpg" alt="Population analysis results in the Anomaly Explorer" /></div></div><p>As in this case, the results are often quite sparse. There might be just a few
data points for the selected time period. Population analysis is particularly
useful when you have many entities and the data for specific entitles is sporadic
or sparse.</p><p>If you click on a section in the timeline or swimlanes, you can see more
details about the anomalies:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-population-anomaly.jpg" alt="Anomaly details for a specific user" /></div></div><p>In this example, the user identified as <code class="literal">antonette</code> sent a high volume of bytes
on the date and time shown. This event is anomalous because the mean is two times
higher than the expected behavior of the population.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-configuring-transform"></a>Transforming Data With Script Fields<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/transforms.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you use datafeeds, you can add scripts to transform your data before
it is analyzed. Datafeeds contain an optional <code class="literal">script_fields</code> property, where
you can specify scripts that evaluate custom expressions and return script
fields.</p><p>If your datafeed defines script fields, you can use those fields in your job.
For example, you can use the script fields in the analysis functions in one or
more detectors.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform1" title="Example 1: Adding two numerical fields">Example 1: Adding two numerical fields</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform2" title="Example 2: Concatenating strings">Example 2: Concatenating strings</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform3" title="Example 3: Trimming strings">Example 3: Trimming strings</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform4" title="Example 4: Converting strings to lowercase">Example 4: Converting strings to lowercase</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform5" title="Example 5: Converting strings to mixed case formats">Example 5: Converting strings to mixed case formats</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform6" title="Example 6: Replacing tokens">Example 6: Replacing tokens</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform7" title="Example 7: Regular expression matching and concatenation">Example 7: Regular expression matching and concatenation</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform8" title="Example 8: Splitting strings by domain name">Example 8: Splitting strings by domain name</a>
</li><li class="listitem">
<a class="xref" href="ml-configuring.html#ml-configuring-transform9" title="Example 9: Transforming geo_point data">Example 9: Transforming geo_point data</a>
</li></ul></div><p>The following indices APIs create and add content to an index that is used in
subsequent examples:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /my_index
{
  "mappings":{
    "my_type":{
      "properties": {
        "@timestamp": {
          "type": "date"
        },
        "aborted_count": {
          "type": "long"
        },
        "another_field": {
          "type": "keyword" <a id="CO60-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        },
        "clientip": {
          "type": "keyword"
        },
        "coords": {
          "properties": {
            "lat": {
              "type": "keyword"
            },
            "lon": {
              "type": "keyword"
            }
          }
        },
        "error_count": {
          "type": "long"
        },
        "query": {
          "type": "keyword"
        },
        "some_field": {
          "type": "keyword"
        },
        "tokenstring1":{
          "type":"keyword"
        },
        "tokenstring2":{
          "type":"keyword"
        },
        "tokenstring3":{
          "type":"keyword"
        }
      }
    }
  }
}

PUT /my_index/my_type/1
{
  "@timestamp":"2017-03-23T13:00:00",
  "error_count":36320,
  "aborted_count":4156,
  "some_field":"JOE",
  "another_field":"SMITH  ",
  "tokenstring1":"foo-bar-baz",
  "tokenstring2":"foo bar baz",
  "tokenstring3":"foo-bar-19",
  "query":"www.ml.elastic.co",
  "clientip":"123.456.78.900",
  "coords": {
    "lat" : 41.44,
    "lon":90.5
  }
}</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/5.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO60-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
In this example, string fields are mapped as <code class="literal">keyword</code> fields to support
aggregation. If you want both a full text (<code class="literal">text</code>) and a keyword (<code class="literal">keyword</code>)
version of the same field, use multi-fields. For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/multi-fields.html" target="_top">fields</a>.
</p></td></tr></table></div><p><a id="ml-configuring-transform1"></a><strong>Example 1: Adding two numerical fields. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/test1
{
  "analysis_config":{
    "bucket_span": "10m",
    "detectors":[
      {
        "function":"mean",
        "field_name": "total_error_count", <a id="CO61-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "detector_description": "Custom script field transformation"
      }
    ]
  },
  "data_description": {
  "time_field":"@timestamp",
  "time_format":"epoch_ms"
  }
}

PUT _xpack/ml/datafeeds/datafeed-test1
{
  "job_id": "test1",
  "indices": ["my_index"],
  "types": ["my_type"],
  "query": {
    "match_all": {
          "boost": 1
    }
  },
  "script_fields": {
    "total_error_count": { <a id="CO61-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "script": {
        "lang": "expression",
        "inline": "doc['error_count'].value + doc['aborted_count'].value"
      }
    }
  }
}</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO61-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A script field named <code class="literal">total_error_count</code> is referenced in the detector
within the job.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO61-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The script field is defined in the datafeed.
</p></td></tr></table></div><p>This <code class="literal">test1</code> job contains a detector that uses a script field in a mean analysis
function. The <code class="literal">datafeed-test1</code> datafeed defines the script field. It contains a
script that adds two fields in the document to produce a "total" error count.</p><p>The syntax for the <code class="literal">script_fields</code> property is identical to that used by Elasticsearch.
For more information, see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-request-script-fields.html" target="_top">Script Fields</a>.</p><p>You can preview the contents of the datafeed by using the following API:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET _xpack/ml/datafeeds/datafeed-test1/_preview</pre></div><div class="console_widget" data-snippet="snippets/ml-configuring/6.json"></div><p>In this example, the API returns the following results, which contain a sum of
the <code class="literal">error_count</code> and <code class="literal">aborted_count</code> values:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "total_error_count": 40476
  }
]</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example demonstrates how to use script fields, but it contains
insufficient data to generate meaningful results. For a full demonstration of
how to create jobs with sample data, see <a class="xref" href="ml-getting-started.html" title="Getting Started with Machine Learning"><em>Getting Started</em></a>.</p></div></div><p>You can alternatively use Kibana to create an advanced job that uses script
fields. To add the <code class="literal">script_fields</code> property to your datafeed, you must use the
<span class="strong strong"><strong>Edit JSON</strong></span> tab. For example:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ml-scriptfields.jpg" alt="Adding script fields to a datafeed in Kibana" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ml-configuring-transform-examples"></a>Common Script Field Examples<a href="https://github.com/elastic/stack-docs/edit/6.x/../elasticsearch/x-pack/docs/en/ml/transforms.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>While the possibilities are limitless, there are a number of common scenarios
where you might use script fields in your datafeeds.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Some of these examples use regular expressions. By default, regular
expressions are disabled because they circumvent the protection that Painless
provides against long running and memory hungry scripts. For more information,
see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/modules-scripting-painless.html" target="_top">Painless Scripting Language</a>.</p><p>Machine learning analysis is case sensitive. For example, "John" is considered
to be different than "john". This is one reason you might consider using scripts
that convert your strings to upper or lowercase letters.</p></div></div><p><a id="ml-configuring-transform2"></a><strong>Example 2: Concatenating strings. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/test2
{
  "analysis_config":{
    "bucket_span": "10m",
    "detectors":[
      {
        "function":"low_info_content",
        "field_name":"my_script_field", <a id="CO62-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "detector_description": "Custom script field transformation"
      }
    ]
  },
  "data_description": {
  "time_field":"@timestamp",
  "time_format":"epoch_ms"
  }
}

PUT _xpack/ml/datafeeds/datafeed-test2
{
  "job_id": "test2",
  "indices": ["my_index"],
  "types": ["my_type"],
  "query": {
    "match_all": {
          "boost": 1
    }
  },
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "doc['some_field'].value + '_' + doc['another_field'].value" <a id="CO62-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO62-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The script field has a rather generic name in this case, since it will
be used for various tests in the subsequent examples.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO62-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The script field uses the plus (+) operator to concatenate strings.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that "JOE"
and "SMITH  " have been concatenated and an underscore was added:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "JOE_SMITH  "
  }
]</pre></div><p><a id="ml-configuring-transform3"></a><strong>Example 3: Trimming strings. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/datafeeds/datafeed-test2/_update
{
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "doc['another_field'].value.trim()" <a id="CO63-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO63-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script field uses the <code class="literal">trim()</code> function to trim extra white space from a
string.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that "SMITH  "
has been trimmed to "SMITH":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "SMITH"
  }
]</pre></div><p><a id="ml-configuring-transform4"></a><strong>Example 4: Converting strings to lowercase. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/datafeeds/datafeed-test2/_update
{
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "doc['some_field'].value.toLowerCase()" <a id="CO64-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO64-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script field uses the <code class="literal">toLowerCase</code> function to convert a string to all
lowercase letters. Likewise, you can use the <code class="literal">toUpperCase{}</code> function to convert
a string to uppercase letters.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that "JOE"
has been converted to "joe":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "joe"
  }
]</pre></div><p><a id="ml-configuring-transform5"></a><strong>Example 5: Converting strings to mixed case formats. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/datafeeds/datafeed-test2/_update
{
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "doc['some_field'].value.substring(0, 1).toUpperCase() + doc['some_field'].value.substring(1).toLowerCase()" <a id="CO65-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO65-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script field is a more complicated example of case manipulation. It uses
the <code class="literal">subString()</code> function to capitalize the first letter of a string and
converts the remaining characters to lowercase.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that "JOE"
has been converted to "Joe":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "Joe"
  }
]</pre></div><p><a id="ml-configuring-transform6"></a><strong>Example 6: Replacing tokens. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/datafeeds/datafeed-test2/_update
{
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "/\\s/.matcher(doc['tokenstring2'].value).replaceAll('_')" <a id="CO66-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO66-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script field uses regular expressions to replace white
space with underscores.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that
"foo bar baz" has been converted to "foo_bar_baz":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "foo_bar_baz"
  }
]</pre></div><p><a id="ml-configuring-transform7"></a><strong>Example 7: Regular expression matching and concatenation. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST _xpack/ml/datafeeds/datafeed-test2/_update
{
  "script_fields": {
    "my_script_field": {
      "script": {
        "lang": "painless",
        "inline": "def m = /(.*)-bar-([0-9][0-9])/.matcher(doc['tokenstring3'].value); return m.find() ? m.group(1) + '_' + m.group(2) : '';" <a id="CO67-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test2/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
This script field looks for a specific regular expression pattern and emits the
matched groups as a concatenated string. If no match is found, it emits an empty
string.
</p></td></tr></table></div><p>The preview datafeed API returns the following results, which show that
"foo-bar-19" has been converted to "foo_19":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_script_field": "foo_19"
  }
]</pre></div><p><a id="ml-configuring-transform8"></a><strong>Example 8: Splitting strings by domain name. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/test3
{
  "description":"DNS tunneling",
  "analysis_config":{
    "bucket_span": "30m",
    "influencers": ["clientip","hrd"],
    "detectors":[
      {
        "function":"high_info_content",
        "field_name": "sub",
        "over_field_name": "hrd",
        "exclude_frequent":"all"
      }
    ]
  },
  "data_description": {
  "time_field":"@timestamp",
  "time_format":"epoch_ms"
  }
}

PUT _xpack/ml/datafeeds/datafeed-test3
{
  "job_id": "test3",
  "indices": ["my_index"],
  "types": ["my_type"],
  "query": {
    "match_all": {
          "boost": 1
    }
  },
  "script_fields":{
    "sub":{
      "script":"return domainSplit(doc['query'].value, params).get(0);"
    },
    "hrd":{
      "script":"return domainSplit(doc['query'].value, params).get(1);"
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test3/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><p>If you have a single field that contains a well-formed DNS domain name, you can
use the <code class="literal">domainSplit()</code> function to split the string into its highest registered
domain and the sub-domain, which is everything to the left of the highest
registered domain. For example, the highest registered domain of
<code class="literal">www.ml.elastic.co</code> is <code class="literal">elastic.co</code> and the sub-domain is <code class="literal">www.ml</code>. The
<code class="literal">domainSplit()</code> function returns an array of two values: the first value is the
subdomain; the second value is the highest registered domain.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The <code class="literal">domainSplit()</code> function takes two arguments. The first argument is
the string you want to split. The second argument is always <code class="literal">params</code>. This is a
technical implementation detail related to how Painless operates internally.</p></div></div><p>The preview datafeed API returns the following results, which show that
"www.ml.elastic.co" has been split into "elastic.co" and "www.ml":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "clientip.keyword": "123.456.78.900",
    "hrd": "elastic.co",
    "sub": "www.ml"
  }
]</pre></div><p><a id="ml-configuring-transform9"></a><strong>Example 9: Transforming geo_point data. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/ml/anomaly_detectors/test4
{
  "analysis_config":{
    "bucket_span": "10m",
    "detectors":[
      {
        "function":"lat_long",
        "field_name": "my_coordinates"
      }
    ]
  },
  "data_description": {
  "time_field":"@timestamp",
  "time_format":"epoch_ms"
  }
}

PUT _xpack/ml/datafeeds/datafeed-test4
{
  "job_id": "test4",
  "indices": ["my_index"],
  "types": ["my_type"],
  "query": {
    "match_all": {
          "boost": 1
    }
  },
  "script_fields": {
    "my_coordinates": {
      "script": {
        "inline": "doc['coords.lat'].value + ',' + doc['coords.lon'].value",
        "lang": "painless"
      }
    }
  }
}

GET _xpack/ml/datafeeds/datafeed-test4/_preview</pre></div><p>
</p><div class="console_widget" data-snippet=":CONSOLE:"></div><p>In Elasticsearch, location data can be stored in <code class="literal">geo_point</code> fields but this data type is
not supported natively in X-Pack machine learning analytics. This example of a script field
transforms the data into an appropriate format. For more information,
see <a class="xref" href="ml-functions.html#ml-geo-functions" title="Geographic Functions">Geographic Functions</a>.</p><p>The preview datafeed API returns the following results, which show that
<code class="literal">41.44</code> and <code class="literal">90.5</code> have been combined into "41.44,90.5":</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">[
  {
    "@timestamp": 1490274000000,
    "my_coordinates": "41.44,90.5"
  }
]</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="ml-getting-started.html">
              « 
              Getting Started with Machine Learning</a>
           
        </span><span class="next">
           
          <a href="stopping-ml.html">Stopping Machine Learning
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form id="mktoForm_1398" class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack">X-Pack</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/as-a-service">Elastic Cloud</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/enterprise">Elastic Cloud Enterprise</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/security">Security (formerly Shield)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/alerting">Alerting (via Watcher)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/monitoring">Monitoring (formerly Marvel)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">ES-Hadoop</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Press</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="facebook"><a id="footer_facebook" href="http://www.facebook.com/elastic.co"></a></li>
          
          		 	<li class="twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic"></a></li>
          
          		 	<li class="linkedin"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co"></a></li>
          
          		 	<li class="xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co"></a></li>
          
          		 	<li class="youtube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch"></a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-policy">Privacy</a></li>
				<li><a href="/legal/privacy-and-cookie-policy">Cookie Policy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">				
				<div class="footer-text">
					<p>© 2018. All Rights Reserved - Elasticsearch
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>			
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a></div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .linkedin a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .linkedin a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .linkedin a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .youtube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .youtube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .youtube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
  MktoForms2.whenReady(function (form) {
  //    // Put your code that uses the form object here
  //   $('#Email').attr("placeholder","Email Address");
  //   $('#FirstName').attr("placeholder","First Name");
  //   $('#LastName').attr("placeholder","Last Name");
  //   $('#Form_Message').attr("placeholder","Tell us in your words");
  // // ========================End Mktoform placeholder==================
  });
  MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
    console.log("inside footer form", form);
    form.onSuccess(function(form){
      $('#mktoForm_1398').css('display','none');
      $('.subscribe-wrapper .subscribe-form-container').hide();
      $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
      dataLayer.push({'event': 'mktoFormSubmit'});
        return false;
      });
  });
</script>
      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script> 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>