<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring Role-based Access Control
        | Elastic Stack Overview [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [master]" /><link rel="up" href="xpack-security.html" title="Securing the Elastic Stack" /><link rel="prev" href="saml-guide.html" title="Configuring SAML Single-Sign-On on the Elastic Stack" /><link rel="next" href="auditing.html" title="Auditing Security Events" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/master" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.subject" content="Elastic Stack" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.identifier" content="master" />
    <!-- RTP tag -->
    <script type='text/javascript' async>
    (function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);})(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");

    rtp('send','view');
    rtp('get', 'campaign',true);
    </script> 
    <!-- End of RTP tag -->
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	   
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // ---------------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
        locales = {
            '/en/': '/',
            '/de/': '/de/',
            '/fr/': '/fr/',
            '/ja/':'/jp/',
            '/ko/':'/kr/',
            '/zh/':'/cn/'
        }
        localepages = ['/','/de/','/fr/','/jp/','/kr/','/cn/','/products','/de/products','/fr/products','/jp/products','/kr/products','/cn/products'],
        locationpath = window.location.pathname,
        localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
        currentlocale = JSON.parse(localeUrl);
    
      if(localepages.indexOf(locationpath) != -1){
        if($.cookie("c_lang")){
          if($.cookie("c_lang") != currentlocale.relative_url_prefix){
            var cookieurl = $.cookie("c_lang") + currentlocale.url.slice(1,currentlocale.url.length);
            window.location = cookieurl;
          }
        }
        else{
          var locale_lang = "/";
          if(locales[lang] != undefined){
            locale_lang = locales[lang];
          }
          $.cookie("c_lang",locale_lang ,{ expires: 365, path: '/'}); 
          window.location = localepages[localepages.indexOf(locationpath)];
        }
      }
      
      // --------------------- end of set language based on browser language -----------------
      </script>


	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- begin olark code -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
    f[z]=function(){
    (a.s=a.s||[]).push(arguments)};var a=f[z]._={
    },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
    0:+new Date};a.P=function(u){
    a.p[u]=new Date-a.p[0]};function s(){
    a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
    hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
    return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
    b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
    b.contentWindow[g].open()}catch(w){
    c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
    var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
    b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
    /* custom configuration goes here (www.olark.com/documentation) */
    olark.identify('1356-750-10-5709');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1356-750-10-5709/contact" title="Contact us">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <!-- end olark code -->

<!--     <script> 
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
      ga('create', 'UA-12395217-16', 'auto'); 
      ga('send', 'pageview'); 
    </script> -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->
    
    <!-- Header Section -->
    
<header class="header-wrapper">
  


  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <h1>
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/bltd5ac38b4549d53de/elastic-logo-mobile (1).svg" alt="elastic-logo-mobile">
              </a>
            </h1>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>
            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                <li><a href="/" data-value="/" id="locale-select">English</a></li>
                
                  
                    
                  
                <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                
                  
                    
                  
                <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                
                  
                    
                  
                <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                
                  
                    
                  
                <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                
                  
                    
                  
                <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <h1>
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt6050efb80ceabd47/elastic-logo (2).svg" alt="elastic-logo">
          </a>
        </h1>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a id="nav_products" class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_cloud" class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_services" class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_customers" class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_learn" class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
          <li class="hidden-xs lang global-language">
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              <li><a class="" href="/" data-value="/">English</a></li>
              
                
                  
                
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
                
                  
                
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
                
                  
                
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
                
                  
                
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
                
                  
                
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-security.html">Securing the Elastic Stack</a></span> » <span class="breadcrumb-node">Configuring Role-based Access Control</span></div><div class="navheader"><span class="prev"><a href="saml-guide.html">
              « 
              Configuring SAML Single-Sign-On on the Elastic Stack</a>
           
        </span><span class="next">
           
          <a href="auditing.html">Auditing Security Events
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="authorization"></a>Configuring Role-based Access Control<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>X-Pack security introduces the concept of <span class="emphasis"><em>authorization</em></span> to Elasticsearch.
Authorization is the process of determining whether the user behind an incoming
request is allowed to execute it. This process takes place once a request is
successfully authenticated and the user behind the request is identified.</p><h3><a id="roles"></a>Roles, Permissions and Privileges<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The authorization process revolves around the following 5 constructs:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<span class="emphasis"><em>Secured Resource</em></span>
</span></dt><dd>
A resource to which access is restricted. Indices/aliases, documents, fields,
users and the Elasticsearch cluster itself are all examples of secured objects.
</dd><dt><span class="term">
<span class="emphasis"><em>Privilege</em></span>
</span></dt><dd>
A named group representing one or more actions that a user may execute against a
secured resource. Each secured resource has its own sets of available privileges.
For example, <code class="literal">read</code> is an index privilege that represents all actions that enable
reading the indexed/stored data. For a complete list of available privileges
see <a class="xref" href="security-reference.html#security-privileges" title="Security Privileges">Security Privileges</a>.
</dd><dt><span class="term">
<span class="emphasis"><em>Permissions</em></span>
</span></dt><dd><p class="simpara">
A set of one or more privileges against a secured resource. Permissions can
easily be described in words, here are few examples:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">read</code> privilege on the <code class="literal">products</code> index
</li><li class="listitem">
<code class="literal">manage</code> privilege on the cluster
</li><li class="listitem">
<code class="literal">run_as</code> privilege on <code class="literal">john</code> user
</li><li class="listitem">
<code class="literal">read</code> privilege on documents that match query X
</li><li class="listitem">
<code class="literal">read</code> privilege on <code class="literal">credit_card</code> field
</li></ul></div></dd><dt><span class="term">
<span class="emphasis"><em>Role</em></span>
</span></dt><dd>
A named sets of permissions
</dd><dt><span class="term">
<span class="emphasis"><em>User</em></span>
</span></dt><dd>
The authenticated user.
</dd></dl></div><p>A secure Elasticsearch cluster manages the privileges of users through <span class="emphasis"><em>roles</em></span>.
A role has a unique name and identifies a set of permissions that translate to
privileges on resources. A user can be associated with an arbitrary number of
roles. The total set of permissions that a user has is therefore defined by
union of the permissions in all its roles.</p><p>As an administrator, you will need to define the roles that you want to use,
then assign users to the roles. These can be assigned to users in a number of
ways depending on the realms by which the users are authenticated.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="built-in-roles"></a>Built-in Roles<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>X-Pack security applies a default role to all users, including
<a class="link" href="setting-up-authentication.html#anonymous-access" title="Enabling Anonymous Access">anonymous users</a>. The default role enables users to access
the authenticate endpoint, change their own passwords, and get information about
themselves.</p><p>X-Pack security also provides a set of built-in roles you can explicitly assign
to users. These roles have a fixed set of privileges and cannot be updated.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a id="built-in-roles-ingest-user"></a> <code class="literal">ingest_admin</code> 
</span></dt><dd><p class="simpara">
Grants access to manage <span class="strong strong"><strong>all</strong></span> index templates and <span class="strong strong"><strong>all</strong></span> ingest pipeline configurations.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role does <span class="strong strong"><strong>not</strong></span> provide the ability to create indices; those privileges
must be defined in a separate role.</p></div></div></dd><dt><span class="term">
<a id="built-in-roles-kibana-dashboard"></a> <code class="literal">kibana_dashboard_only_user</code> 
</span></dt><dd>
Grants access to the Kibana Dashboard and read-only permissions on the <code class="literal">.kibana</code>
index. This role does not have access to editing tools in Kibana. For more
information, see
<a class="ulink" href="https://www.elastic.co/guide/en/kibana/master/xpack-dashboard-only-mode.html" target="_top">Kibana Dashboard Only Mode</a>.
</dd><dt><span class="term">
<a id="built-in-roles-kibana-system"></a> <code class="literal">kibana_system</code> 
</span></dt><dd><p class="simpara">
Grants access necessary for the Kibana system user to read from and write to the
Kibana indices, manage index templates, and check the availability of the Elasticsearch cluster.
This role grants read access to the <code class="literal">.monitoring-*</code> indices and read and write access
to the <code class="literal">.reporting-*</code> indices. For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/kibana/master/using-kibana-with-security.html" target="_top">Configuring Security in Kibana</a>.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role should not be assigned to users as the granted permissions may
change between releases.</p></div></div></dd><dt><span class="term">
<a id="built-in-roles-kibana-user"></a> <code class="literal">kibana_user</code>
</span></dt><dd>
Grants the minimum privileges required for any user of Kibana. This role grants
access to the Kibana indices and grants  monitoring privileges for the cluster.
</dd><dt><span class="term">
<a id="built-in-roles-logstash-admin"></a> <code class="literal">logstash_admin</code> 
</span></dt><dd>
Grants access to the <code class="literal">.logstash*</code> indices for managing configurations.
</dd><dt><span class="term">
<a id="built-in-roles-logstash-system"></a> <code class="literal">logstash_system</code> 
</span></dt><dd><p class="simpara">
Grants access necessary for the Logstash system user to send system-level data
(such as monitoring) to Elasticsearch. For more information, see
<a class="ulink" href="http://www.elastic.co/guide/en/logstash/master/ls-security.html" target="_top">Configuring Security in Logstash</a>.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role should not be assigned to users as the granted permissions may
change between releases.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role does not provide access to the logstash indices and is not
suitable for use within a Logstash pipeline.</p></div></div></dd><dt><span class="term">
<a id="built-in-roles-beats-system"></a> <code class="literal">beats_system</code> 
</span></dt><dd><p class="simpara">
Grants access necessary for the Beats system user to send system-level data
(such as monitoring) to Elasticsearch.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role should not be assigned to users as the granted permissions may
change between releases.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This role does not provide access to the beats indices and is not
suitable for writing beats output to Elasticsearch.</p></div></div></dd><dt><span class="term">
<a id="built-in-roles-ml-admin"></a> <code class="literal">machine_learning_admin</code>
</span></dt><dd>
Grants <code class="literal">manage_ml</code> cluster privileges and read access to the <code class="literal">.ml-*</code> indices.
</dd><dt><span class="term">
<a id="built-in-roles-ml-user"></a> <code class="literal">machine_learning_user</code>
</span></dt><dd>
Grants the minimum privileges required to view X-Pack machine learning configuration,
status, and results. This role grants <code class="literal">monitor_ml</code> cluster privileges and
read access to the <code class="literal">.ml-notifications</code> and <code class="literal">.ml-anomalies*</code> indices,
which store machine learning results.
</dd><dt><span class="term">
<a id="built-in-roles-monitoring-user"></a> <code class="literal">monitoring_user</code>
</span></dt><dd>
Grants the minimum privileges required for any user of X-Pack monitoring other than those
required to use Kibana. This role grants access to the monitoring indices and grants
privileges necessary for reading basic cluster information. Monitoring users should
also be assigned the <code class="literal">kibana_user</code> role.
</dd><dt><span class="term">
<a id="built-in-roles-remote-monitoring-agent"></a> <code class="literal">remote_monitoring_agent</code>
</span></dt><dd>
Grants the minimum privileges required for a remote monitoring agent to write data
into this cluster.
</dd><dt><span class="term">
<a id="built-in-roles-reporting-user"></a> <code class="literal">reporting_user</code>
</span></dt><dd>
Grants the specific privileges required for users of X-Pack reporting other than those
required to use Kibana. This role grants access to the reporting indices. Reporting
users should also be assigned the <code class="literal">kibana_user</code> role and a role that grants them
access to the data that will be used to generate reports with.
</dd><dt><span class="term">
<a id="built-in-roles-superuser"></a> <code class="literal">superuser</code>
</span></dt><dd>
Grants full access to the cluster, including all indices and data. A user with
the <code class="literal">superuser</code> role can also manage users and roles and
<a class="link" href="authorization.html#run-as-privilege" title="Submitting Requests on Behalf of Other Users">impersonate</a> any other user in the system. Due to the
permissive nature of this role, take extra care when assigning it to a user.
</dd><dt><span class="term">
<a id="built-in-roles-transport-client"></a> <code class="literal">transport_client</code>
</span></dt><dd><p class="simpara">
Grants the privileges required to access the cluster through the Java Transport
Client. The Java Transport Client fetches information about the nodes in the
cluster using the <span class="emphasis"><em>Node Liveness API</em></span> and the <span class="emphasis"><em>Cluster State API</em></span> (when
sniffing is enabled). Assign your users this role if they use the
Transport Client.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Using the Transport Client effectively means the users are granted access
to the cluster state. This means users can view the metadata over all indices,
index templates, mappings, node and basically everything about the cluster.
However, this role does not grant permission to view the data in all indices.</p></div></div></dd><dt><span class="term">
<a id="built-in-roles-watcher-admin"></a> <code class="literal">watcher_admin</code>
</span></dt><dd>Grants write access to the <code class="literal">.watches</code> index, read access to the watch history and
the triggered watches index and allows to execute all watcher actions.</dd><dt><span class="term">
<a id="built-in-roles-watcher-user"></a> <code class="literal">watcher_user</code>
</span></dt><dd>Grants read access to the <code class="literal">.watches</code> index, the get watch action and the watcher
stats.</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="defining-roles"></a>Defining Roles<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A role is defined by the following JSON structure:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "run_as": [ ... ], <a id="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "cluster": [ ... ], <a id="CO13-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  "indices": [ ... ] <a id="CO13-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A list of usernames the owners of this role can <a class="link" href="authorization.html#run-as-privilege" title="Submitting Requests on Behalf of Other Users">impersonate</a>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A list of cluster privileges. These privileges define the
    cluster level actions users with this role are able to execute. This field
    is optional (missing <code class="literal">cluster</code> privileges effectively mean no cluster level
    permissions).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A list of indices permissions entries. This field is optional (missing <code class="literal">indices</code>
    privileges effectively mean no index level permissions).
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><a id="valid-role-name"></a><p>Role names must be at least 1 and no more than 1024 characters. They can
      contain alphanumeric characters (<code class="literal">a-z</code>, <code class="literal">A-Z</code>, <code class="literal">0-9</code>), spaces,
      punctuation, and printable symbols in the <a class="ulink" href="https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block)" target="_top">Basic Latin (ASCII) block</a>.
      Leading or trailing whitespace is not allowed.</p></div></div><p>The following describes the structure of an indices permissions entry:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "names": [ ... ], <a id="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "privileges": [ ... ], <a id="CO14-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  "field_security" : { ... }, <a id="CO14-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
  "query": "..." <a id="CO14-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A list of indices (or index name patterns) to which the permissions in this
    entry apply.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The index level privileges the owners of the role have on the associated
    indices (those indices that are specified in the <code class="literal">name</code> field)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specification for document fields the owners of the role have read access to.
    See <a class="xref" href="authorization.html#field-and-document-access-control" title="Setting Up Field and Document Level Security">Setting Up Field and Document Level Security</a> for details.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A search query that defines the documents the owners of the role have read
    access to. A document within the associated indices must match this query
    in order for it to be accessible by the owners of the role.
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>When specifying index names, you can use indices and aliases with their full
names or regular expressions that refer to multiple indices.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Wildcard (default) - simple wildcard matching where <code class="literal">*</code> is a placeholder
  for zero or more characters, <code class="literal">?</code> is a placeholder for a single character
  and <code class="literal">\</code> may be used as an escape character.
</li><li class="listitem">
Regular Expressions - A more powerful syntax for matching more complex
  patterns. This regular expression is based on Lucene’s regexp automaton
  syntax. To enable this syntax, it must be wrapped within a pair of
  forward slashes (<code class="literal">/</code>). Any pattern starting with <code class="literal">/</code> and not ending with
  <code class="literal">/</code> is considered to be malformed.
</li></ul></div><p><strong>Example Regular Expressions. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">"foo-bar":               # match the literal `foo-bar`
"foo-*":                 # match anything beginning with "foo-"
"logstash-201?-*":       # ? matches any one character
"/.*-201[0-9]-.*/":      # use a regex to match anything containing 2010-2019
"/foo":                  # syntax error - missing final /</pre></div><p>
</p></div></div><p>The following snippet shows an example definition of a <code class="literal">clicks_admin</code> role:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "run_as": [ "clicks_watcher_1" ]
  "cluster": [ "monitor" ],
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "field_security" : {
        "grant" : [ "category", "@timestamp", "message" ]
      },
      "query": "{\"match\": {\"category\": \"click\"}}"
    }
  ]
}</pre></div><p>Based on the above definition, users owning the <code class="literal">clicks_admin</code> role can:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Impersonate the <code class="literal">clicks_watcher_1</code> user and execute requests on its behalf.
</li><li class="listitem">
Monitor the Elasticsearch cluster
</li><li class="listitem">
Read data from all indices prefixed with <code class="literal">events-</code>
</li><li class="listitem">
Within these indices, only read the events of the <code class="literal">click</code> category
</li><li class="listitem">
Within these document, only read the <code class="literal">category</code>, <code class="literal">@timestamp</code> and <code class="literal">message</code>
    fields.
</li></ul></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>For a complete list of available <a class="link" href="security-reference.html#security-privileges" title="Security Privileges">cluster and indices privileges</a></p></div></div><p>There are two available mechanisms to define roles: using the <span class="emphasis"><em>Role Management APIs</em></span>
or in local files on the Elasticsearch nodes.  X-Pack security also supports implementing
custom roles providers.  If you need to integrate with another system to retrieve
user roles, you can build a custom roles provider plugin. For more information,
see <a class="link" href="authorization.html#custom-roles-provider" title="Custom Roles Provider Extension">Custom Roles Provider Extension</a>.</p><h3><a id="roles-management-ui"></a>Role Management UI<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>X-Pack security enables you to easily manage users and roles from within Kibana. To
manage roles, log in to Kibana and go to <span class="strong strong"><strong>Management / Elasticsearch / Roles</strong></span>.</p><h3><a id="roles-management-api"></a>Role Management API<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <span class="emphasis"><em>Role Management APIs</em></span> enable you to add, update, remove and retrieve roles
dynamically. When you use the APIs to manage roles in the <code class="literal">native</code> realm, the
roles are stored in an internal Elasticsearch index. For more information and examples,
see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/security-api-roles.html" target="_top">Role Management APIs</a>.</p><h3><a id="roles-management-file"></a>File-based Role Management<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Apart from the <span class="emphasis"><em>Role Management APIs</em></span>, roles can also be defined in local
<code class="literal">roles.yml</code> file located in <code class="literal">CONFIG_DIR/x-pack</code>. This is a YAML file where each
role definition is keyed by its name.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If the same role name is used in the <code class="literal">roles.yml</code> file and through the
<span class="emphasis"><em>Role Management APIs</em></span>, the role found in the file will be used.</p></div></div><p>While the <span class="emphasis"><em>Role Management APIs</em></span> is the preferred mechanism to define roles,
using the <code class="literal">roles.yml</code> file becomes useful if you want to define fixed roles that
no one (beside an administrator having physical access to the Elasticsearch nodes)
would be able to change.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The <code class="literal">roles.yml</code> file is managed locally by the node and is not globally by the
cluster. This means that with a typical multi-node cluster, the exact same
changes need to be applied on each and every node in the cluster.</p><p>A safer approach would be to apply the change on one of the nodes and have the
<code class="literal">roles.yml</code> distributed/copied to all other nodes in the cluster (either
manually or using a configuration management system such as Puppet or Chef).</p></div></div><p>The following snippet shows an example of the <code class="literal">roles.yml</code> file configuration:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">click_admins:
  run_as: [ 'clicks_watcher_1' ]
  cluster: [ 'monitor' ]
  indices:
    - names: [ 'events-*' ]
      privileges: [ 'read' ]
      field_security:
        grant: ['category', '@timestamp', 'message' ]
      query: '{"match": {"category": "click"}}'</pre></div><p>X-Pack security continuously monitors the <code class="literal">roles.yml</code> file and automatically picks
up and applies any changes to it.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="securing-aliases"></a>Granting Privileges for Indices &amp; Aliases<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/alias-privileges.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch allows to execute operations against <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/indices-aliases.html" target="_top">index aliases</a>,
which are effectively virtual indices. An alias points to one or more indices,
holds metadata and potentially a filter. X-Pack security treats aliases and indices
the same. Privileges for indices actions are granted on specific indices or
aliases. In order for an indices action to be authorized, the user that executes
it needs to have permissions for that action on all the specific indices or
aliases that the request relates to.</p><p>Let’s look at an example. Assuming we have an index called <code class="literal">2015</code>, an alias that
points to it called <code class="literal">current_year</code>, and a user with the following role:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "names" : [ "2015" ],
  "privileges" : [ "read" ]
}</pre></div><p>The user attempts to retrieve a document from <code class="literal">current_year</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">GET /current_year/event/1</pre></div><div class="console_widget" data-snippet="snippets/authorization/1.json"></div><p>The above request gets rejected, although the user has <code class="literal">read</code> privilege on the
concrete index that the <code class="literal">current_year</code> alias points to. The correct permission
would be as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "names" : [ "current_year" ],
  "privileges" : [ "read" ]
}</pre></div><h4><a id="_managing_aliases"></a>Managing aliases<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/alias-privileges.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Unlike creating indices, which requires the <code class="literal">create_index</code> privilege, adding,
removing and retrieving aliases requires the <code class="literal">manage</code> permission. Aliases can be
added to an index directly as part of the index creation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">PUT /2015
{
    "aliases" : {
        "current_year" : {}
    }
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/2.json"></div><p>or via the dedicated aliases api if the index already exists:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">POST /_aliases
{
    "actions" : [
        { "add" : { "index" : "2015", "alias" : "current_year" } }
    ]
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/3.json"></div><p>The above requests both require the <code class="literal">manage</code> privilege on the alias name as well
as the targeted index, as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "names" : [ "20*", "current_year" ],
  "privileges" : [ "manage" ]
}</pre></div><p>The index aliases api also allows also to delete aliases from existing indices.
The privileges required for such a request are the same as above. Both index and
alias need the <code class="literal">manage</code> permission.</p><h4><a id="_filtered_aliases"></a>Filtered aliases<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/alias-privileges.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Aliases can hold a filter, which allows to select a subset of documents that can
be accessed out of all the documents that the physical index contains. These
filters are not always applied and should not be used in place of
<a class="link" href="authorization.html#document-level-security" title="Document Level Security">document level security</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-roles"></a>Mapping Users and Groups to Roles<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you authenticate users with the <code class="literal">native</code> or <code class="literal">file</code> realms, you can manage
role assignment by using the <a class="link" href="setting-up-authentication.html#managing-native-users" title="Managing Native Users">User Management APIs</a> or
the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/users-command.html" target="_top">users</a> command-line tool respectively.</p><p>For other types of realms, you must create <span class="emphasis"><em>role-mappings</em></span> that define which
roles should be assigned to each user based on their username, groups, or
other metadata.</p><p>X-Pack security allows role-mappings to be defined via an
<a class="link" href="authorization.html#mapping-roles-api" title="Using the Role Mapping API">API</a>, or managed through <a class="link" href="authorization.html#mapping-roles-file" title="Using Role Mapping Files">files</a>.
These two sources of role-mapping are combined inside of X-Pack security, so it is
possible for a single user to have some roles that have been mapped through
the API, and other roles that are mapped through files.</p><p>When you use role-mappings, you assign existing roles to users.
The available roles should either be added using the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/security-api-roles.html" target="_top">Role Management APIs</a> or defined in the
<a class="link" href="authorization.html#roles-management-file" title="File-based Role Managementedit">roles file</a>. Either role-mapping method can use
either role management method. For example, when you use the role mapping API,
you are able to map users to both API-managed roles and file-managed roles
(and likewise for file-based role-mappings).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mapping-roles-api"></a>Using the Role Mapping API<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can define role-mappings through the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/security-api-role-mapping.html" target="_top">role mapping API</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mapping-roles-file"></a>Using Role Mapping Files<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To use file based role-mappings, you must configure the mappings in a YAML file
and copy it to each node in the cluster. Tools like Puppet or Chef can help with
this.</p><p>By default, role mappings are stored in <code class="literal">ES_PATH_CONF/x-pack/role_mapping.yml</code>,
where <code class="literal">ES_PATH_CONF</code> is <code class="literal">ES_HOME/config</code> (zip/tar installations) or
<code class="literal">/etc/elasticsearch</code> (package installations). To specify a different location,
you configure the <code class="literal">files.role_mapping</code> realm settings in <code class="literal">elasticsearch.yml</code>.
This setting enables you to use a different set of mappings for each realm type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><tbody><tr><td align="left" valign="top"><p><code class="literal">xpack.security.authc.ldap.files.role_mapping</code></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p>The location of the role mappings for LDAP realms.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">xpack.security.authc.active_directory.files.role_mapping</code></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p>The location of the role mappings for Active Directory realms.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">xpack.security.authc.pki.files.role_mapping</code></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p></p></td><td align="left" valign="top"><p>The location of the role mappings for PKI realms.</p></td></tr></tbody></table></div><p>Within the role mapping file, the security roles are keys and groups and users
are values. The mappings can have a many-to-many relationship. When you map roles
to groups, the roles of a user in that group are the combination of the roles
assigned to that group and the roles assigned to that user.</p><p>By default, X-Pack security checks role mapping files for changes every 5 seconds.
You can change this default behavior by changing the
<code class="literal">resource.reload.interval.high</code> setting in the <code class="literal">elasticsearch.yml</code> file. Since
this is a common setting in Elasticsearch, changing its value might effect other
schedules in the system.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_realm_specific_details"></a>Realm Specific Details<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><h5><a id="ldap-role-mapping"></a>Active Directory and LDAP Realms<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>To specify users and groups in the role mappings, you use their
<span class="emphasis"><em>Distinguished Names</em></span> (DNs). A DN is a string that uniquely identifies the user
or group, for example <code class="literal">"cn=John Doe,cn=contractors,dc=example,dc=com"</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>X-Pack security only supports Active Directory security groups. You cannot map
      distribution groups to roles.</p></div></div><p>For example, the following snippet uses the file-based method to map the
<code class="literal">admins</code> group to the <code class="literal">monitoring</code> role and map the <code class="literal">John Doe</code> user, the
<code class="literal">users</code> group, and the <code class="literal">admins</code> group to the <code class="literal">user</code> role.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">monitoring: <a id="CO15-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  - "cn=admins,dc=example,dc=com" <a id="CO15-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
user:
  - "cn=John Doe,cn=contractors,dc=example,dc=com" <a id="CO15-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
  - "cn=users,dc=example,dc=com"
  - "cn=admins,dc=example,dc=com"</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of a X-Pack security role.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The distinguished name of an LDAP group or an Active Directory security group.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The distinguished name of an LDAP or Active Directory user.
</p></td></tr></table></div><p>You can use the role-mapping API to define equivalent mappings as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role_mapping/admins
{
  "roles" : [ "monitoring", "user" ],
  "rules" : { "field" : { "groups" : "cn=admins,dc=example,dc=com" } },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/4.json"></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role_mapping/basic_users
{
  "roles" : [ "user" ],
  "rules" : { "any" : [
      { "field" : { "dn" : "cn=John Doe,cn=contractors,dc=example,dc=com" } },
      { "field" : { "groups" : "cn=users,dc=example,dc=com" } }
  ] },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/5.json"></div><h5><a id="pki-role-mapping"></a>PKI Realms<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/mapping-roles.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>PKI realms support mapping users to roles, but you cannot map groups as
the PKI realm has no notion of a group.</p><p>This is an example using a file-based mapping:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">monitoring:
  - "cn=Admin,ou=example,o=com"
user:
  - "cn=John Doe,ou=example,o=com"</pre></div><p>The following example creates equivalent mappings using the API:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role_mapping/admin_user
{
  "roles" : [ "monitoring" ],
  "rules" : { "field" : { "dn" : "cn=Admin,ou=example,o=com" } },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/6.json"></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _xpack/security/role_mapping/basic_user
{
  "roles" : [ "user" ],
  "rules" : { "field" : { "dn" : "cn=John Doe,ou=example,o=com" } },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/authorization/7.json"></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="field-and-document-access-control"></a>Setting Up Field and Document Level Security<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can control access to data within an index by adding field and document level
security permissions to a role. Field level security permissions restrict access
to particular fields within a document. Document level security permissions
restrict access to particular documents within an index.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Document and field level security is currently meant to operate with
read-only privileged accounts. Users with document and field level
security enabled for an index should not perform write operations.</p></div></div><p>A role can define both field and document level permissions on a per-index basis.
A role that doesn’t specify field level permissions grants access to ALL fields.
Similarly, a role that doesn’t specify document level permissions grants access
to ALL documents in the index.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>When assigning users multiple roles, be careful that you don’t inadvertently
grant wider access than intended. Each user has a single set of field level and
document level permissions per index. See <a class="xref" href="authorization.html#multiple-roles-dls-fls" title="Multiple Roles with Document and Field Level Security">Multiple Roles with Document and Field Level Security</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="field-level-security"></a>Field Level Security<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To enable field level security, specify the fields that each role can access
as part of the indices permissions in a role definition. Field level security is
thus bound to a well-defined set of indices (and potentially a set of
<a class="link" href="authorization.html#document-level-security" title="Document Level Security">documents</a>).</p><p>The following role definition grants read access only to the <code class="literal">category</code>,
<code class="literal">@timestamp</code>, and <code class="literal">message</code> fields in all the <code class="literal">events-*</code> indices.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "field_security" : {
        "grant" : [ "category", "@timestamp", "message" ]
      }
    }
  ]
}</pre></div><p>Access to the following meta fields is always allowed: <code class="literal">_id</code>,
<code class="literal">_type</code>, <code class="literal">_parent</code>, <code class="literal">_routing</code>, <code class="literal">_timestamp</code>, <code class="literal">_ttl</code>, <code class="literal">_size</code> and <code class="literal">_index</code>. If
you specify an empty list of fields, only these meta fields are accessible.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Omitting the fields entry entirely disables field-level security.</p></div></div><p>You can also specify field expressions. For example, the following
example grants read access to all fields that start with an <code class="literal">event_</code> prefix:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "event_*" ]
      }
    }
  ]
}</pre></div><p>Use the dot notations to refer to nested fields in more complex documents. For
example, assuming the following document:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "customer": {
    "handle": "Jim",
    "email": "jim@mycompany.com",
    "phone": "555-555-5555"
  }
}</pre></div><p>The following role definition enables only read access to the customer <code class="literal">handle</code>
field:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "customer.handle" ]
      }
    }
  ]
}</pre></div><p>This is where wildcard support shines. For example, use <code class="literal">customer.*</code> to enable
only read access to the <code class="literal">customer</code> data:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "customer.*" ]
      }
    }
  ]
}</pre></div><p>You can deny permission to access fields with the following syntax:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant" : [ "*"],
        "except": [ "customer.handle" ]
      }
    }
  ]
}</pre></div><p>The following rules apply:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The absence of <code class="literal">field_security</code> in a role is equivalent to * access.
</li><li class="listitem">
If permission has been granted explicitly to some fields, you can specify
denied fields. The denied fields must be a subset of the fields to which
permissions were granted.
</li><li class="listitem">
Defining denied and granted fields implies access to all granted fields except
those which match the pattern in the denied fields.
</li></ul></div><p>For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "except": [ "customer.handle" ],
        "grant" : [ "customer.*" ]
      }
    }
  ]
}</pre></div><p>In the above example, users can read all fields with the prefix "customer."
except for "customer.handle".</p><p>An empty array for <code class="literal">grant</code> (for example, <code class="literal">"grant" : []</code>) means that access has
not been granted to any fields.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_field_level_security_and_roles"></a>Field Level Security and Roles<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When a user has several roles that specify field level permissions, the
resulting field level permissions per index are the union of the individual role
permissions. For example, if these two roles are merged:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  // role 1
  ...
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.*" ],
        "except" : [ "a.b*" ]
      }
    }
  ]
}

{
  // role 2
  ...
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.b*" ],
        "except" : [ "a.b.c*" ]
      }
    }
  ]
}</pre></div><p>The resulting permission is equal to:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  // role 1 + role 2
  ...
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "field_security" : {
        "grant": [ "a.*" ],
        "except" : [ "a.b.c*" ]
      }
    }
  ]
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="document-level-security"></a>Document Level Security<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Document level security restricts the documents that users have read access to.
To enable document level security, specify a query that matches all the
accessible documents as part of the indices permissions within a role definition.
Document level security is thus bound to a well defined set of indices.</p><p>Enabling document level security restricts which documents can be accessed from
any document-based read API. To enable document level security, you use a query
to specify the documents that each role can access in the <code class="literal">roles.yml</code> file.
You specify the document query with the <code class="literal">query</code> option. The document query is
associated with a particular index or index pattern and operates in conjunction
with the privileges specified for the indices.</p><p>The following role definition grants read access only to documents that
belong to the <code class="literal">click</code> category within all the <code class="literal">events-*</code> indices:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices": [
    {
      "names": [ "events-*" ],
      "privileges": [ "read" ],
      "query": "{\"match\": {\"category\": \"click\"}}"
    }
  ]
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Omitting the <code class="literal">query</code> entry entirely disables document level security for
      the respective indices permission entry.</p></div></div><p>The specified <code class="literal">query</code> expects the same format as if it was defined in the
search request and supports the full Elasticsearch <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl.html" target="_top">Query DSL</a>.</p><p>For example, the following role grants read access only to the documents whose
<code class="literal">department_id</code> equals <code class="literal">12</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "*" ],
      "privileges" : [ "read" ],
      "query" : {
        "term" : { "department_id" : 12 }
      }
    }
  ]
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">query</code> also accepts queries written as string values.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="templating-role-query"></a>Templating a Role Query<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>You can use Mustache templates in a role query to insert the username of the
current authenticated user into the role. Like other places in Elasticsearch that support
templating or scripting, you can specify inline, stored, or file-based templates
and define custom parameters. You access the details for the current
authenticated user through the <code class="literal">_user</code> parameter.</p><p>For example, the following role query uses a template to insert the username
of the current authenticated user:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "my_index" ],
      "privileges" : [ "read" ],
      "query" : {
        "template" : {
          "source" : {
            "term" : { "acl.username" : "{{_user.username}}" }
          }
        }
      }
    }
  ]
}</pre></div><p>You can access the following information through the <code class="literal">_user</code> variable:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top"> Property              </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">_user.username</code></p></td><td align="left" valign="top"><p>The username of the current authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_user.full_name</code></p></td><td align="left" valign="top"><p>If specified, the full name of the current authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_user.email</code></p></td><td align="left" valign="top"><p>If specified, the email of the current authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_user.roles</code></p></td><td align="left" valign="top"><p>If associated, a list of the role names of the current authenticated user.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_user.metadata</code></p></td><td align="left" valign="top"><p>If specified, a hash holding custom metadata of the current authenticated user.</p></td></tr></tbody></table></div><p>You can also access custom user metadata. For example, if you maintain a
<code class="literal">group_id</code> in your user metadata, you can apply document level security
based on the <code class="literal">group.id</code> field in your documents:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "indices" : [
    {
      "names" : [ "my_index" ],
      "privileges" : [ "read" ],
      "query" : {
        "template" : {
          "source" : {
            "term" : { "group.id" : "{{_user.metadata.group_id}}" }
          }
        }
      }
    }
  ]
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="set-security-user-processor"></a>Set Security User Ingest Processor<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If an index is shared by many small users it makes sense to put all these users
into the same index.  Having a dedicated index or shard per user is wasteful.
To guarantee that a user reads only their own documents, it makes sense to set up
document level security. In this scenario, each document must have the username
or role name associated with it, so that this information can be used by the
role query for document level security. This is a situation where the
<code class="literal">set_security_user</code> ingest processor can help.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Document level security doesn’t apply to write APIs. You must use unique
ids for each user that uses the same index, otherwise they might overwrite other
users' documents. The ingest processor just adds properties for the current
authenticated user to the documents that are being indexed.</p></div></div><p>The <code class="literal">set_security_user</code> processor attaches user-related details (such as
<code class="literal">username</code>,  <code class="literal">roles</code>, <code class="literal">email</code>, <code class="literal">full_name</code> and <code class="literal">metadata</code> ) from the current
authenticated user to the current document by pre-processing the ingest. When
you index data with an ingest pipeline, user details are automatically attached
to the document. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT shared-logs/log/1?pipeline=my_pipeline_id
{
  ...
}</pre></div><p>Read the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/ingest.html" target="_top">ingest docs</a> for more information
about setting up a pipeline and other processors.</p><div class="table"><a id="set-security-user-options"></a><p class="title"><strong>Table 8. Set Security User Options</strong></p><div class="table-contents"><table summary="Set Security User Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name          </th><th align="left" valign="top"> Required  </th><th align="left" valign="top"> Default                                                   </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">field</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The field to store the user information into.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">properties</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>[<code class="literal">username</code>, <code class="literal">roles</code>, <code class="literal">email</code>, <code class="literal">full_name</code>, <code class="literal">metadata</code>]</p></td><td align="left" valign="top"><p>Controls what user related properties are added to the <code class="literal">field</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>The following example adds all user details for the current authenticated user
to the <code class="literal">user</code> field for all documents that are processed by this pipeline:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "processors" : [
    {
      "set_security_user": {
        "field": "user"
      }
    }
  ]
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="multiple-roles-dls-fls"></a>Multiple Roles with Document and Field Level Security<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/field-and-document-access-control.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A user can have many roles and each role can define different permissions on the
same index. It is important to understand the behavior of document and field
level security in this scenario.</p><p>Document level security takes into account each role held by the user and
combines each document level security query for a given index with an "OR". This
means that only one of the role queries must match for a document to be returned.
For example, if a role grants access to an index without document level security
and another grants access with document level security, document level security
is not applied; the user with both roles has access to all of the documents in
the index.</p><p>Field level security takes into account each role the user has and combines
all of the fields listed into a single set for each index. For example, if a
role grants access to an index without field level security and another grants
access with field level security, field level security is not be applied for
that index; the user with both roles has access to all of the fields in the
index.</p><p>For example, let’s say <code class="literal">role_a</code> grants access to only the <code class="literal">address</code> field of the
documents in <code class="literal">index1</code>; it doesn’t specify any document restrictions. Conversely,
<code class="literal">role_b</code> limits access to a subset of the documents in <code class="literal">index1</code>; it doesn’t
specify any field restrictions. If you assign a user both roles, <code class="literal">role_a</code> gives
the user access to all documents and <code class="literal">role_b</code> gives the user access to all
fields.</p><p>If you need to restrict access to both documents and fields, consider splitting
documents by index instead.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="run-as-privilege"></a>Submitting Requests on Behalf of Other Users<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/run-as-privilege.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>X-Pack security supports a permission that enables an authenticated user to submit
requests on behalf of other users. If your application already authenticates
users, you can use the <span class="emphasis"><em>run as</em></span> mechanism to restrict data access according to
X-Pack security permissions without having to re-authenticate each user through.</p><p>To "run as" (impersonate) another user, you must be able to retrieve the user from
the realm you use to authenticate. Both the internal <code class="literal">native</code> and <code class="literal">file</code> realms
support this out of the box. The LDAP realm must be configured to run in
<a class="link" href="setting-up-authentication.html#ldap-user-search" title="User Search Mode"><span class="emphasis"><em>user search</em></span> mode</a>. The Active Directory realm must be
<a class="link" href="setting-up-authentication.html#ad-settings" title="Active Directory Realm Settings">configured with a <code class="literal">bind_dn</code> and <code class="literal">secure_bind_password</code></a> to support
<span class="emphasis"><em>run as</em></span>. The PKI realm does not support <span class="emphasis"><em>run as</em></span>.</p><p>To submit requests on behalf of other users, you need to have the <code class="literal">run_as</code>
permission. For example, the following role grants permission to submit request
on behalf of <code class="literal">jacknich</code> or <code class="literal">redeniro</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "run_as" : [ "jacknich", "rdeniro" ]
}</pre></div><p>To submit a request as another user, you specify the user in the
<code class="literal">es-security-runas-user</code> request header. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">curl -H "es-security-runas-user: jacknich"  -u es_admin -XGET 'http://localhost:9200/'</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="custom-roles-provider"></a>Custom Roles Provider Extension<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/custom-roles-provider.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you need to retrieve user roles from a system not supported out-of-the-box
by X-Pack security, you can create a custom roles provider to retrieve and resolve
roles. You implement a custom roles provider as an SPI loaded security extension
as part of an ordinary elasticsearch plugin.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="implementing-custom-roles-provider"></a>Implementing a Custom Roles Provider<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/custom-roles-provider.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To create a custom roles provider:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Implement the interface <code class="literal">BiConsumer&lt;Set&lt;String&gt;, ActionListener&lt;Set&lt;RoleDescriptor&gt;&gt;&gt;</code>.
  That is to say, the implementation consists of one method that takes a set of strings,
  which are the role names to resolve, and an ActionListener, on which the set of resolved
  role descriptors are passed on as the response.
</li><li class="listitem">
The custom roles provider implementation must take special care to not block on any I/O
  operations.  It is the responsibility of the implementation to ensure asynchronous behavior
  and non-blocking calls, which is made easier by the fact that the <code class="literal">ActionListener</code> is
  provided on which to send the response when the roles have been resolved and the response
  is ready.
</li></ol></div><p>To package your custom roles provider as a plugin:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Implement an extension class for your roles provider that implements
  <code class="literal">org.elasticsearch.xpack.core.security.SecurityExtension</code>. There you need to
  override one or more of the following methods:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">@Override
public List&lt;BiConsumer&lt;Set&lt;String&gt;, ActionListener&lt;Set&lt;RoleDescriptor&gt;&gt;&gt;&gt;
getRolesProviders(Settings settings, ResourceWatcherService resourceWatcherService) {
    ...
}</pre></div><p class="simpara">The <code class="literal">getRolesProviders</code> method is used to provide a list of custom roles providers that
will be used to resolve role names, if the role names could not be resolved by the reserved
roles or native roles stores.   The list should be returned in the order that the custom role
providers should be invoked to resolve roles.  For example, if <code class="literal">getRolesProviders</code> returns two
instances of roles providers, and both of them are able to resolve role <code class="literal">A</code>, then the resolved
role descriptor that will be used for role <code class="literal">A</code> will be the one resolved by the first roles
provider in the list.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">@Override
public List&lt;String&gt; getSettingsFilter() {
    ...
}</pre></div><p class="simpara">The <code class="literal">Plugin#getSettingsFilter</code> method returns a list of setting names that should be
filtered from the settings APIs as they may contain sensitive credentials. Note this method is not
part of the <code class="literal">SecurityExtension</code> interface, it’s available as part of the elasticsearch plugin main class.</p></li><li class="listitem">
Create a build configuration file for the plugin; Gradle is our recommendation.
</li><li class="listitem">
Create a <code class="literal">META-INF/services/org.elasticsearch.xpack.core.security.SecurityExtension</code> descriptor file for the
  extension that contains the fully qualified class name of your <code class="literal">org.elasticsearch.xpack.core.security.SecurityExtension</code> implementation
</li><li class="listitem">
Bundle all in a single zip file.
</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using-custom-roles-provider"></a>Using a Custom Roles Provider to Resolve Roles<a href="https://github.com/elastic/stack-docs/edit/master/../elasticsearch/x-pack/docs/en/security/authorization/custom-roles-provider.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To use a custom roles provider:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Install the roles provider extension on each node in the cluster. You run
  <code class="literal">bin/elasticsearch-plugin</code> with the <code class="literal">install</code> sub-command and specify the URL
  pointing to the zip file that contains the extension. For example:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">bin/elasticsearch-plugin install file:///&lt;path&gt;/my-roles-provider-1.0.zip</pre></div></li><li class="listitem"><p class="simpara">
Add any configuration parameters for any of the custom roles provider implementations
to <code class="literal">elasticsearch.yml</code>.  The settings are not namespaced and you have access to any
settings when constructing the custom roles providers, although it is recommended to
have a namespacing convention for custom roles providers to keep your <code class="literal">elasticsearch.yml</code>
configuration easy to understand.
</p><p class="simpara">For example, if you have a custom roles provider that
resolves roles from reading a blob in an S3 bucket on AWS, then you would specify settings
in <code class="literal">elasticsearch.yml</code> such as:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">custom_roles_provider.s3_roles_provider.bucket: roles
custom_roles_provider.s3_roles_provider.region: us-east-1
custom_roles_provider.s3_roles_provider.secret_key: xxx
custom_roles_provider.s3_roles_provider.access_key: xxx</pre></div><p class="simpara">These settings will be available as the first parameter in the <code class="literal">getRolesProviders</code> method, from
where you will create and return the custom roles provider instances.</p></li><li class="listitem">
Restart Elasticsearch.
</li></ol></div></div></div></div><div class="navfooter"><span class="prev"><a href="saml-guide.html">
              « 
              Configuring SAML Single-Sign-On on the Elastic Stack</a>
           
        </span><span class="next">
           
          <a href="auditing.html">Auditing Security Events
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form id="mktoForm_1398" class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack">X-Pack</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/as-a-service">Elastic Cloud</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/enterprise">Elastic Cloud Enterprise</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/security">Security (formerly Shield)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/alerting">Alerting (via Watcher)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/monitoring">Monitoring (formerly Marvel)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">ES-Hadoop</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Press</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="facebook"><a id="footer_facebook" href="http://www.facebook.com/elastic.co"></a></li>
          
          		 	<li class="twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic"></a></li>
          
          		 	<li class="linkedin"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co"></a></li>
          
          		 	<li class="xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co"></a></li>
          
          		 	<li class="youtube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch"></a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-policy">Privacy</a></li>
				<li><a href="/legal/privacy-and-cookie-policy">Cookie Policy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">				
				<div class="footer-text">
					<p>© 2018. All Rights Reserved - Elasticsearch
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>			
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a></div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .linkedin a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .linkedin a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .linkedin a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .youtube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .youtube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .youtube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
  MktoForms2.whenReady(function (form) {
  //    // Put your code that uses the form object here
  //   $('#Email').attr("placeholder","Email Address");
  //   $('#FirstName').attr("placeholder","First Name");
  //   $('#LastName').attr("placeholder","Last Name");
  //   $('#Form_Message').attr("placeholder","Tell us in your words");
  // // ========================End Mktoform placeholder==================
  });
  MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
    console.log("inside footer form", form);
    form.onSuccess(function(form){
      $('#mktoForm_1398').css('display','none');
      $('.subscribe-wrapper .subscribe-form-container').hide();
      $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
      dataLayer.push({'event': 'mktoFormSubmit'});
        return false;
      });
  });
</script>
      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script> 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>